function Calendar(t,e,a,n,r,l,i){this.language=n||1,this.patternDelimiter=r||"-",this.date2StringPattern=l||Calendar.language.date2StringPattern[this.language].replace(/\-/g,this.patternDelimiter),this.string2DatePattern=i||Calendar.language.string2DatePattern[this.language],this.dateControl=null,this.div=t,this.selected=e;var s=a.split("-");this.date=new Date(s[0],s[1]-1),this.year=this.date.getFullYear(),this.month=this.date.getMonth()}Calendar.language={year:["年","","","年"],months:[["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]],weeks:[["日","一","二","三","四","五","六"],["Sun","Mon","Tur","Wed","Thu","Fri","Sat"],["Sun","Mon","Tur","Wed","Thu","Fri","Sat"],["日","一","二","三","四","五","六"]],clear:["清空","Clear","Clear","清空"],today:["今天","Today","Today","今天"],close:["关闭","Close","Close","關閉"],date2StringPattern:["yyyy-MM-dd","yyyy-MM-dd","yyyy-MM-dd","yyyy-MM-dd"],string2DatePattern:["ymd","ymd","ymd","ymd"]},Calendar.prototype.draw=function(){calendar=this;var t=[];t[t.length]='<table id="__calendarTable" border="0" cellpadding="0" cellspacing="0" class="month">',t[t.length]=" <tr>";for(var e=["sun","mon","tue","wed","thu","fri","sat"],a=0;7>a;a++)t[t.length]='<th class="'+e[a]+'">',t[t.length]=Calendar.language.weeks[this.language][a],t[t.length]="</th>";t[t.length]="</tr>";for(var a=0;6>a;a++){t[t.length]='<tr align="center">';for(var n=0;7>n;n++)t[t.length]='<td class="'+e[n]+'">&nbsp;</td>';t[t.length]="</tr>"}t[t.length]="</table>",this.div.innerHTML=t.join("")},Calendar.prototype.bindData=function(){for(var t=this,e=this.getMonthViewDateArray(this.date.getFullYear(),this.date.getMonth()),a=this.getElementsByTagName("td",this.getElementById("__calendarTable")),n=0;n<a.length;n++)if(a[n].onclick=null,a[n].onmouseover=null,a[n].onmouseout=null,void 0==e[n]?a[n].innerHTML='<div class="cell undo"></div>':a[n].innerHTML='<div class="cell">'+e[n]+"</div>"||"&nbsp;",!(n>e.length-1)&&e[n]){for(var r in this.selected)this.selected[r]==e[n]&&(a[n].innerHTML='<div class="cell done">'+e[n]+"</div>"||"&nbsp;");var l=new Date;l.getFullYear()==t.date.getFullYear()&&l.getMonth()+1==t.date.getMonth()&&l.getDate()==e[n]&&$(a[n]).addClass("current")}},Calendar.prototype.getMonthViewDateArray=function(t,e){for(var a=new Array(42),n=new Date(t,e,1).getDay(),r=new Date(t,e+1,0).getDate(),l=0;r>l;l++)a[l+n]=l+1;return a},Calendar.prototype.show=function(t,e){this.draw(),this.bindData()},Calendar.prototype.getElementById=function(t,e){return e=e||document,document.getElementById?e.getElementById(t):document.all(t)},Calendar.prototype.getElementsByTagName=function(t,e){return e=e||document,document.getElementsByTagName?e.getElementsByTagName(t):document.all.tags(t)},Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"w+":"日一二三四五六".charAt(this.getDay()),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in e)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[a]:("00"+e[a]).substr((""+e[a]).length)));return t},String.prototype.toDate=function(t,e){t=t||"-",e=e||"ymd";var a=this.split(t),n=parseInt(a[e.indexOf("y")],10);n.toString().length<=2&&(n+=2e3),isNaN(n)&&(n=(new Date).getFullYear());var r=parseInt(a[e.indexOf("m")],10)-1,l=parseInt(a[e.indexOf("d")],10);return isNaN(l)&&(l=1),new Date(n,r,l)};
function init(){$("#date").html(t[0]+"年"+t[1]+"月"),setNavLink();var e=[];if(data)for(var n in data)e.push(data[n].split("-")[2]),data[n]==now&&(isSign=!0);var a=new Calendar(oo,e,month);a.show()}function doDakaAction(){return 1==isSign?(layer.open({content:"今天已打过拉",btn:["OK"]}),!1):month!=idx?(layer.open({content:"请回到"+date.getFullYear()+"年"+(date.getMonth()+1)+"月打卡哦，不允许超前或滞后打卡",btn:["OK"]}),!1):(0!=data?data.push(now):data=new Array(now),storage.setItem(idx,JSON.stringify(data)),isSign=!0,$(".current .cell").addClass("done"),void layer.open({content:"打卡成功",btn:["OK"]}))}function setNavLink(){var e=formatMonth(t),n="http://"+location.host+location.pathname;$("#prev").attr("href",n+"?t="+e.prev),$("#next").attr("href",n+"?t="+e.next)}function getQueryString(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(e);return null!=n?unescape(n[2]):null}function formatMonth(t){t[0]=parseInt(t[0]),t[1]=parseInt(t[1]);var e=[];return t[1]-1==0?(e[0]=t[0]-1,e[1]=12,e[2]=2,{prev:e[0]+"-"+e[1],next:t[0]+"-"+e[2]}):t[1]+1>12?(e[0]=t[0]+1,e[1]=1,e[2]=11,{prev:t[0]+"-"+e[2],next:e[0]+"-"+e[1]}):(e[0]=t[0],e[1]=t[1]-1,e[2]=t[1]+1,{prev:e[0]+"-"+e[1],next:e[0]+"-"+e[2]})}var oo=document.getElementById("dateTime"),storage=window.localStorage,date=new Date,idx=date.getFullYear()+"-"+(date.getMonth()+1),now=date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate();month=getQueryString("t")||idx,t=month.split("-"),isSign=!1,data=JSON.parse(storage.getItem(month))||!1,init();